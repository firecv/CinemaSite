@using System.Globalization

@{
    ViewData["Title"] = "Zgloszenia";
    var currentDate = DateTime.Today;
    var translateToPolish = new CultureInfo("pl-PL");
}

@model CinemaSite.ViewModels.AdminViewModel

@section Styles {
    <link rel="stylesheet" href="~/css/admin.css" />
}

<div class="admin-form">
    <button id="new-article-button">Dodaj nowy film</button>

    <table id="article-table">
        <thead>
            <tr>
                <th>Artykuły</th>
            </tr>
        </thead>
        <tbody id="articles-list">
            @foreach (var article in Model.Articles)
            {
                var imageFile = $"/Content/img{article.image_id}.jpg";
                var postDate = article.post_date.ToString("yyyy-MM-dd");

                <tr class="article-row"
                    data-id="@article.article_id"
                    data-title="@article.title"
                    data-image="@imageFile"
                    data-content="@article.content"
                    data-publication="@postDate">
                    <td>
                        <div>
                            <div>
                                <p>@article.title</p>
                                <img src="@imageFile" style="max-height: 100px;" alt="Zdjęcie dla artykułu @article.title" />
                                <p>@postDate</p>
                            </div>
                            <div class="control-box">
                                <button data-id="@article.article_id"
                                        data-title="@article.title"
                                        class="delete-button">
                                    SKASUJ
                                </button>
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


<div id="new-article-modal" class="admin-modal" hidden style="position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 999;
    background-color: rbga(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);">
    <!--THIS ^^^ WILL BE MOVED TO CSS LATER!-->
    <div id="new-article-modal-info" class="admin-modal-info" style="background-color: gray;">

        <button class="form-xbutton" id="new-article-xbutton">X</button>

        <h2>Dane Artykułu</h2>
        <form class="movie-details-form" asp-controller="Admin" asp-action="AddArticleDB" method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()

            <input asp-for="ArticleDTO.article_id" type="hidden" id="na-id" />

            <div>
                <label>Tytuł</label>
                <input asp-for="ArticleDTO.title" id="na-title" required />
            </div>
            <div>
                <label>Zdjęcie (plik musi mieć rozszerzenie .jpg)</label>
                <input asp-for="ArticleDTO.image" id="na-title" type="file" accept="image/jpg" required />
            </div>
            <div>
                <label>Treść</label>
                <textarea asp-for="ArticleDTO.content" id="na-content" required></textarea>
            </div>
            <div>
                <label>Data/Czas Wydania</label> <!--add like a tooltip or something later-->
                <input asp-for="ArticleDTO.post_date" id="na-publication" type="date" required />
            </div>

            <button type="submit">Zapisz detale artykułu</button>
        </form>
    </div>
</div>

<div id="modal-article" class="admin-modal" hidden style="position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 999;
    background-color: rbga(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);">
    <!--THIS ^^^ WILL BE MOVED TO CSS LATER!-->
    <div id="modal-article-info" class="admin-modal-info" style="background-color: gray;">

        <button class="form-xbutton" id="xbutton">X</button>
        
        <h2>Dane artykułu</h2>
        <form class="movie-details-form" asp-controller="Admin" asp-action="EditArticleDB" method="post">
            @Html.AntiForgeryToken()

            <input asp-for="ArticleDTO.article_id" type="hidden" id="edit-id" />

            <div>
                <label>Tytuł</label>
                <input asp-for="ArticleDTO.title" id="edit-title" />
            </div>
            <div>
                <label>Treść</label>
                <textarea asp-for="ArticleDTO.content" id="edit-content"></textarea>
            </div>
            <div>
                <label>Data/Czas Wydania</label> <!--add like a tooltip or something later-->
                <input asp-for="ArticleDTO.post_date" id="edit-publication" type="date" required />
            </div>

            <button type="submit">Zapisz detale artykułu</button>
        </form>
    </div>
</div>

<div id="modal-delete" hidden style="position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 999;
    background-color: rbga(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);">
    <!--THIS ^^^ WILL BE MOVED TO CSS LATER!-->
    <div id="modal-delete-confirm" style="background-color: gray;">
        <form asp-controller="Admin" asp-action="DeleteArticle" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" id="article-to-delete">
            <label id="confirmation-message"></label>
            <button type="submit">Zatwierdź</button>
        </form>
    </div>
    <button id="xbutton-delete">Anuluj</button>
</div>

@section Scripts {
    <script src="~/js/modal-admin-article.js" asp-append-version="true" defer></script>
}